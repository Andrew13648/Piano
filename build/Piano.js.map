{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 692394dc363a6dbcee2c","webpack:///external \"tone\"","webpack:///./Salamander.js","webpack:///./Util.js","webpack:///./PianoBase.js","webpack:///./Harmonics.js","webpack:///./Notes.js","webpack:///./Pedal.js","webpack:///./Release.js","webpack:///./Piano.js"],"names":["getReleasesUrl","midi","getHarmonicsUrl","replace","getNotesUrl","vel","noteToMidi","note","toMidi","midiToNote","toNote","midiToFrequencyRatio","mod","intervalToFrequencyRatio","createSource","buffer","randomBetween","low","high","Math","random","PianoBase","vol","createInsOuts","volume","gainToDb","output","gain","value","dbToGain","harmonics","Harmonics","range","lowerIndex","findIndex","upperIndex","length","notes","slice","_samples","n","time","velocity","_sampler","triggerAttack","baseUrl","Promise","success","fail","connect","release","velocitiesMap","Notes","velocities","slicedNotes","_samplers","_activeNotes","Map","forEach","i","hasOwnProperty","has","get","source","stop","delete","velPos","roundedVel","round","diff","ratio","_hasNote","_getNote","playbackRate","curve","start","undefined","set","push","promises","obj","prom","all","Pedal","_downTime","Infinity","_currentSound","_buffers","up","down","dir","_squash","_playSample","Release","Piano","options","defaults","arguments","_loaded","_heldNotes","_sustainedNotes","_notes","_pedal","_harmonics","_release","url","load","then","loaded","toSeconds","isDown","t","clear","now","isString","prevNote","holdTime","prevVel","dampenGain","max","pow","log","param"],"mappings":"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","file":"./build/Piano.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"tone\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"tone\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Piano\"] = factory(require(\"tone\"));\n\telse\n\t\troot[\"Piano\"] = factory(root[\"tone\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 692394dc363a6dbcee2c","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tone\"\n// module id = 0\n// module chunks = 0","import {noteToMidi, midiToNote} from './Util'\n\nexport default {\n\n\tgetReleasesUrl(midi){\n\t\treturn `rel${midi - 20}.[mp3|ogg]`\n\t},\n\n\tgetHarmonicsUrl(midi){\n\t\treturn `harmL${midiToNote(midi).replace('#', 's')}.[mp3|ogg]`\n\t},\n\n\tgetNotesUrl(midi, vel){\n\t\treturn `${midiToNote(midi).replace('#', 's')}v${vel}.[mp3|ogg]`\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Salamander.js","import Tone, { Frequency, BufferSource } from 'tone'\n\nfunction noteToMidi(note){\n\treturn Frequency(note).toMidi()\n}\n\nfunction midiToNote(midi){\n\treturn Frequency(midi, 'midi').toNote()\n}\n\nfunction midiToFrequencyRatio(midi){\n\tlet mod = midi % 3\n\tif (mod === 1){\n\t\treturn [midi - 1, Tone.intervalToFrequencyRatio(1)]\n\t} else if (mod === 2){\n\t\treturn [midi + 1, Tone.intervalToFrequencyRatio(-1)]\n\t} else {\n\t\treturn [midi, 1]\n\t}\n}\n\nfunction createSource(buffer){\n\treturn new BufferSource(buffer)\n}\n\nfunction randomBetween(low, high){\n\treturn Math.random() * (high - low) + low\n}\n\nexport {midiToNote, noteToMidi, createSource, midiToFrequencyRatio, randomBetween}\n\n\n\n// WEBPACK FOOTER //\n// ./Util.js","import Tone, {AudioNode} from 'tone'\n\nexport default class PianoBase extends AudioNode {\n\tconstructor(vol = 0) {\n\t\tsuper()\n\t\tthis.createInsOuts(0, 1)\n\n\t\tthis.volume = vol\n\t}\n\tget volume() {\n\t\treturn Tone.gainToDb(this.output.gain.value)\n\t}\n\tset volume(vol) {\n\t\tthis.output.gain.value = Tone.dbToGain(vol)\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./PianoBase.js","import Salamander from './Salamander'\nimport PianoBase from './PianoBase'\nimport {noteToMidi, createSource, midiToFrequencyRatio, midiToNote, randomBetween} from './Util'\nimport { Buffers , Sampler, Frequency} from 'tone'\n\n// the harmonics notes that Salamander has\nconst harmonics = [21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87]\n\nexport default class Harmonics extends PianoBase {\n\n\tconstructor(range=[21, 108]){\n\t\tsuper()\n\n\t\tconst lowerIndex = harmonics.findIndex((note) => note >= range[0])\n\t\tlet upperIndex = harmonics.findIndex((note) => note >= range[1])\n\t\tupperIndex = upperIndex === -1 ? upperIndex = harmonics.length : upperIndex\n\n\t\tconst notes = harmonics.slice(lowerIndex, upperIndex)\n\n\t\tthis._samples = {}\n\n\t\tfor (let n of notes){\n\t\t\tthis._samples[n] = Salamander.getHarmonicsUrl(n)\n\t\t}\n\t}\n\n\tstart(note, time, velocity){\n\t\t//make sure it's a valid range\n\t\tif (note >= harmonics[0] && note <= harmonics[harmonics.length-1]){\n\t\t\tthis._sampler.triggerAttack(midiToNote(note), time, velocity * randomBetween(0.5, 1))\n\t\t}\n\t}\n\n\tload(baseUrl){\n\t\treturn new Promise((success, fail) => {\n\t\t\tthis._sampler = new Sampler(this._samples, success, baseUrl).connect(this.output)\n\t\t\tthis._sampler.release = 1\n\t\t})\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Harmonics.js","import Tone, { Buffers , MultiSampler} from 'tone'\nimport Salamander from './Salamander'\nimport PianoBase from './PianoBase'\nimport {noteToMidi, createSource, midiToNote, midiToFrequencyRatio} from './Util'\n\n/**\n * Maps velocity depths to Salamander velocities\n */\nconst velocitiesMap = {\n\t1  : [8],\n\t2  : [6, 12],\n\t3  : [1, 8, 15],\n\t4  : [1, 5, 10, 15],\n\t5  : [1, 4, 8, 12, 16],\n\t6  : [1, 3, 7, 10, 13, 16],\n\t7  : [1, 3, 6, 9, 11, 13, 16],\n\t8  : [1, 3, 5, 7, 9, 11, 13, 15],\n\t9  : [1, 3, 5, 7, 9, 11, 13, 15, 16],\n\t10 : [1, 2, 3, 5, 7, 9, 11, 13, 15, 16],\n\t11 : [1, 2, 3, 5, 7, 9, 11, 13, 14, 15, 16],\n\t12 : [1, 2, 3, 4, 5, 7, 9, 11, 13, 14, 15, 16],\n\t13 : [1, 2, 3, 4, 5, 7, 9, 11, 12, 13, 14, 15, 16],\n\t14 : [1, 2, 3, 4, 5, 6, 7, 9, 11, 12, 13, 14, 15, 16],\n\t15 : [1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16],\n\t16 : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],\n}\n\nconst notes = [21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102, 105, 108]\n\n/**\n *  Manages all of the hammered string sounds\n */\nexport class Notes extends PianoBase {\n\n\tconstructor(range=[21, 108], velocities=1){\n\t\tsuper()\n\n\t\tconst lowerIndex = notes.findIndex((note) => note >= range[0])\n\t\tlet upperIndex = notes.findIndex((note) => note >= range[1])\n\t\tupperIndex = upperIndex === -1 ? upperIndex = notes.length : upperIndex + 1\n\n\t\tconst slicedNotes = notes.slice(lowerIndex, upperIndex)\n\n\t\tthis._samplers = velocitiesMap[velocities].slice()\n\n\t\tthis._activeNotes = new Map()\n\n\t\tthis._samplers.forEach((vel, i) => {\n\t\t\tthis._samplers[i] = {}\n\t\t\tslicedNotes.forEach((note) => {\n\t\t\t\tthis._samplers[i][note] = Salamander.getNotesUrl(note, vel)\n\t\t\t})\n\t\t})\n\t}\n\n\t_hasNote(note, velocity){\n\t\treturn this._samplers.hasOwnProperty(velocity) && this._samplers[velocity].has(note)\n\t}\n\n\t_getNote(note, velocity){\n\t\treturn this._samplers[velocity].get(note)\n\t}\n\n\tstop(note, time, velocity){\n\t\t//stop all of the currently playing note\n\t\tif (this._activeNotes.has(note)){\n\t\t\tthis._activeNotes.get(note).forEach(source => {\n\t\t\t\tconst release = 1\n\t\t\t\tsource.stop(time + release, release)\n\t\t\t})\n\t\t\tthis._activeNotes.delete(note)\n\t\t}\n\t}\n\n\tstart(note, time, velocity){\n\n\t\tconst velPos = velocity * (this._samplers.length - 1)\n\t\tconst roundedVel = Math.round(velPos)\n\t\tconst diff = roundedVel - velPos\n\t\tconst gain = 1 - diff * 0.5\n\n\t\tlet [midi, ratio] = midiToFrequencyRatio(note)\n\n\t\tif (this._hasNote(midi, roundedVel)){\n\t\t\tconst source = createSource(this._getNote(midi, roundedVel))\n\t\t\tsource.playbackRate.value = ratio\n\t\t\tsource.connect(this.output)\n\t\t\tsource.curve = 'exponential'\n\t\t\tsource.start(time, 0, undefined, gain, 0)\n\n\t\t\tif (!this._activeNotes.has(note)){\n\t\t\t\tthis._activeNotes.set(note, [])\n\t\t\t}\n\t\t\tthis._activeNotes.get(note).push(source)\n\t\t}\n\t}\n\n\tload(baseUrl){\n\t\tconst promises = []\n\t\tthis._samplers.forEach((obj, i) => {\n\t\t\tlet prom = new Promise((success) => {\n\t\t\t\tthis._samplers[i] = new Buffers(obj, success, baseUrl)\n\t\t\t})\n\t\t\tpromises.push(prom)\n\t\t})\n\t\treturn Promise.all(promises)\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Notes.js","import PianoBase from './PianoBase'\nimport Salamander from './Salamander'\nimport {createSource, randomBetween} from './Util'\nimport Tone, {Buffers} from 'tone'\n\nexport default class Pedal extends PianoBase {\n\tconstructor(){\n\t\tsuper()\n\n\t\tthis._downTime = Infinity\n\n\t\tthis._currentSound = null\n\n\t\tthis._buffers = null\n\t}\n\n\tload(baseUrl){\n\t\treturn new Promise((success) => {\n\t\t\tthis._buffers = new Buffers({\n\t\t\t\tup : 'pedalU1.mp3',\n\t\t\t\tdown : 'pedalD1.mp3'\n\t\t\t}, success, baseUrl)\n\t\t})\n\t}\n\n\t/**\n\t *  Squash the current playing sound\n\t */\n\t_squash(time){\n\t\tif (this._currentSound){\n\t\t\tthis._currentSound.stop(time, 0.1)\n\t\t}\n\t\tthis._currentSound = null\n\t}\n\n\t_playSample(time, dir){\n\t\tthis._currentSound = createSource(this._buffers.get(dir))\n\t\tthis._currentSound.curve = 'exponential'\n\t\tthis._currentSound.connect(this.output).start(time, randomBetween(0, 0.01), undefined, 0.5 * randomBetween(0.5, 1), 0.05)\n\t}\n\n\tdown(time){\n\t\tthis._squash(time)\n\t\tthis._downTime = time\n\t\tthis._playSample(time, 'down')\n\t}\n\n\tup(time){\n\t\tthis._squash(time)\n\t\tthis._downTime = Infinity\n\t\tthis._playSample(time, 'up')\n\t}\n\n\tisDown(time){\n\t\treturn time > this._downTime\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Pedal.js","import Salamander from './Salamander'\nimport PianoBase from './PianoBase'\nimport {createSource, randomBetween} from './Util'\nimport { Buffers } from 'tone'\n\nexport default class Release extends PianoBase {\n\n\tconstructor(range){\n\t\tsuper()\n\n\t\tthis._buffers = {}\n\t\tfor (let i = range[0]; i <= range[1]; i++){\n\t\t\tthis._buffers[i] = Salamander.getReleasesUrl(i)\n\t\t}\n\t}\n\n\tload(baseUrl){\n\t\treturn new Promise((success) => {\n\t\t\tthis._buffers = new Buffers(this._buffers, success, baseUrl)\n\t\t})\n\t}\n\n\tstart(note, time, velocity){\n\t\tif (this._buffers.has(note)){\n\t\t\tlet source = createSource(this._buffers.get(note)).connect(this.output)\n\t\t\t//randomize the velocity slightly\n\t\t\tvelocity *= randomBetween(0.5, 1)\n\t\t\tsource.start(time, 0, undefined, 0.015 * velocity, 0)\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Release.js","import Tone, { Gain, Frequency, AudioNode} from 'tone'\nimport Pedal from './Pedal'\nimport {Notes} from './Notes'\nimport Harmonics from './Harmonics'\nimport Release from './Release'\nimport Salamander from './Salamander'\n\n/**\n *  @class Multisampled Grand Piano using [Salamander Piano Samples](https://archive.org/details/SalamanderGrandPianoV3)\n *  @extends {Tone}\n */\nexport class Piano extends AudioNode {\n\n\tconstructor(){\n\n\t\tconst options = Tone.defaults(arguments, [\"range\", \"velocities\"], {\n\t\t\tvelocities : 1,\n\t\t\trange : [21, 108],\n\t\t\trelease : true\n\t\t});\n\n\t\tsuper()\n\t\tthis.createInsOuts(0, 1)\n\n\t\tthis._loaded = false\n\n\t\tthis._heldNotes = new Map()\n\n\t\tthis._sustainedNotes = new Map()\n\n\t\tthis._notes = new Notes(options.range, options.velocities).connect(this.output)\n\n\t\tthis._pedal = new Pedal().connect(this.output)\n\n\t\tif (options.release){\n\t\t\tthis._harmonics = new Harmonics(options.range).connect(this.output)\n\n\t\t\tthis._release = new Release(options.range).connect(this.output)\n\t\t}\n\t}\n\n\t/**\n\t *  Load all the samples\n\t *  @param  {String}  baseUrl  The url for the Salamander base folder\n\t *  @return  {Promise}\n\t */\n\tload(url='https://tambien.github.io/Piano/Salamander/'){\n\t\tconst promises = [this._notes.load(url), this._pedal.load(url)]\n\t\tif (this._harmonics){\n\t\t\tpromises.push(this._harmonics.load(url))\n\t\t}\n\t\tif (this._release){\n\t\t\tpromises.push(this._release.load(url))\n\t\t}\n\t\treturn Promise.all(promises).then(() => {\n\t\t\tthis._loaded = true\n\t\t})\n\t}\n\n\t/**\n\t * If all the samples are loaded or not\n\t * @readOnly\n\t * @type {Boolean}\n\t */\n\tget loaded(){\n\t\treturn this._loaded\n\t}\n\n\t/**\n\t *  Put the pedal down at the given time. Causes subsequent\n\t *  notes and currently held notes to sustain.\n\t *  @param  {Time}  time  The time the pedal should go down\n\t *  @returns {Piano} this\n\t */\n\tpedalDown(time){\n\t\tif (this.loaded){\n\t\t\ttime = this.toSeconds(time)\n\t\t\tif (!this._pedal.isDown(time)){\n\t\t\t\tthis._pedal.down(time)\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t *  Put the pedal up. Dampens sustained notes\n\t *  @param  {Time}  time  The time the pedal should go up\n\t *  @returns {Piano} this\n\t */\n\tpedalUp(time){\n\t\tif (this.loaded){\n\t\t\ttime = this.toSeconds(time)\n\t\t\tif (this._pedal.isDown(time)){\n\t\t\t\tthis._pedal.up(time)\n\t\t\t\t// dampen each of the notes\n\t\t\t\tthis._sustainedNotes.forEach((t, note) => {\n\t\t\t\t\tif (!this._heldNotes.has(note)){\n\t\t\t\t\t\tthis._notes.stop(note, time)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis._sustainedNotes.clear()\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t *  Play a note.\n\t *  @param  {String|Number}  note      The note to play. If it is a number, it is assumed\n\t *                                     to be MIDI\n\t *  @param  {NormalRange}  velocity  The velocity to play the note\n\t *  @param  {Time}  time      The time of the event\n\t *  @return  {Piano}  this\n\t */\n\tkeyDown(note, time=Tone.now(), velocity=0.8){\n\t\tif (this.loaded){\n\t\t\ttime = this.toSeconds(time)\n\n\t\t\tif (Tone.isString(note)){\n\t\t\t\tnote = Math.round(Frequency(note).toMidi())\n\t\t\t}\n\n\t\t\tif (!this._heldNotes.has(note)){\n\t\t\t\t//record the start time and velocity\n\t\t\t\tthis._heldNotes.set(note, {time, velocity})\n\n\t\t\t\tthis._notes.start(note, time, velocity)\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t *  Release a held note.\n\t *  @param  {String|Number}  note      The note to stop\n\t *  @param  {Time}  time      The time of the event\n\t *  @return  {Piano}  this\n\t */\n\tkeyUp(note, time=Tone.now(), velocity=0.8){\n\t\tif (this.loaded){\n\t\t\ttime = this.toSeconds(time)\n\n\t\t\tif (Tone.isString(note)){\n\t\t\t\tnote = Math.round(Frequency(note).toMidi())\n\t\t\t}\n\n\t\t\tif (this._heldNotes.has(note)){\n\n\t\t\t\tconst prevNote = this._heldNotes.get(note)\n\t\t\t\tthis._heldNotes.delete(note)\n\n\t\t\t\tif (this._release){\n\t\t\t\t\tthis._release.start(note, time, velocity)\n\t\t\t\t}\n\n\t\t\t\t//compute the release velocity\n\t\t\t\tconst holdTime = time - prevNote.time\n\t\t\t\tconst prevVel = prevNote.velocity\n\t\t\t\tlet dampenGain = (0.5/Math.max(holdTime, 0.1)) + prevVel + velocity\n\t\t\t\tdampenGain = Math.pow(Math.log(Math.max(dampenGain, 1)), 2) / 2\n\n\t\t\t\tif (this._pedal.isDown(time)){\n\t\t\t\t\tif (!this._sustainedNotes.has(note)){\n\t\t\t\t\t\tthis._sustainedNotes.set(note, time)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._notes.stop(note, time, velocity)\n\n\t\t\t\t\tif (this._harmonics){\n\t\t\t\t\t\tthis._harmonics.start(note, time, dampenGain)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t *  Set the volumes of each of the components\n\t *  @param {String} param\n\t *  @param {Decibels} vol\n\t *  @return {Piano} this\n\t *  @example\n\t * //either as an string\n\t * piano.setVolume('release', -10)\n\t */\n\tsetVolume(param, vol){\n\t\tswitch(param){\n\t\t\tcase 'note':\n\t\t\t\tthis._notes.volume = vol\n\t\t\t\tbreak\n\t\t\tcase 'pedal':\n\t\t\t\tthis._pedal.volume = vol\n\t\t\t\tbreak\n\t\t\tcase 'release':\n\t\t\t\tif (this._release){\n\t\t\t\t\tthis._release.volume = vol\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'harmonics':\n\t\t\t\tif (this._harmonics){\n\t\t\t\t\tthis._harmonics.volume = vol\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t}\n\t\treturn this\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Piano.js"],"sourceRoot":""}